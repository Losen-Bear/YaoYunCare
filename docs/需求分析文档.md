# “膳韵仙子”小程序项目 需求分析文档（SRS）

版本：v1.0  
状态：草案（可迭代）  
编制依据：ISO/IEC/IEEE 29148、GB/T 25000 系列、OWASP ASVS、微信小程序平台规范

## 1. 项目概述
- 目标：基于微信小程序与 Python 后端，提供“体质评估 → 药膳推荐 → 会员陪伴”的闭环能力，帮助用户用简单方式获得可靠的饮食养生建议。
- 范围：用户登录与会员管理、体质问卷评估、个性化药膳推荐与禁忌提示、内容展示与素材播放、订单与支付、埋点与数据分析、运营配置。
- 不在范围：诊疗服务、处方开具、医疗风险承担；项目仅提供科普及饮食指导。

## 2. 术语与缩写
- 体质：基于中医体质分类（如阴虚、气虚等）的用户健康画像。
- 药膳：食材与药材的组合菜谱，具有养生功效。
- 推荐适配度：菜谱与用户体质匹配的得分，范围 0–100。
- 埋点：对用户行为事件的采集，用于转化分析与优化。

## 3. 角色与用户画像
- 普通用户：18–60 岁，期望快速获知体质与简单可执行的饮食建议。
- 学生群体：希望通过药膳缓解疲劳与焦虑。
- 上班族：希望获得低成本、可复制的日常饮食优化方案。
- 中老年用户：关注慢病调理与四季食材搭配。
- 运营人员：维护菜谱与素材、配置活动、查看数据看板。

## 4. 业务流程概述
1) 小程序登录 → 2) 体质问卷 → 3) 画像计算与解释 → 4) 推荐菜谱与禁忌 → 5) 会员购买（可选）→ 6) 陪伴素材与活动 → 7) 用户反馈与数据闭环。

## 5. 用例列表（关键）
- UC-001 登录与会话：用户使用微信登录，后端换取 session/openId。
- UC-002 体质评估：拉取问卷 → 作答 → 提交 → 得到体质与解释。
- UC-003 药膳推荐：根据体质与偏好返回菜谱列表、禁忌与做法。
- UC-004 会员购买与权益：创建订单、支付、权益生效与到期管理。
- UC-005 内容浏览与虚拟人物：图文/音频素材与人格化陪伴。
- UC-006 埋点与看板：PV/UV、点击、转化、留存等数据采集与可视化。
- UC-007 运营配置：菜谱/素材管理、活动位配置、A/B 测试。

## 6. 功能需求（FR）
- FR-01 微信登录与会话管理，支持 unionId 合并。
- FR-02 问卷管理与体质计算，支持版本化与灰度。
- FR-03 推荐服务：规则引擎 + 打分，支持季节与口味偏好。
- FR-04 禁忌与风险提示：对某些体质/人群给出明确不建议标注。
- FR-05 菜谱详情：食材用量、做法、功效、来源与参考。
- FR-06 会员体系：订阅商品、权益开关、到期提醒与续费。
- FR-07 订单与支付：统一下单、支付回调、账单查询与幂等。
- FR-08 运营 CMS：素材管理、推荐位配置、内容发布。
- FR-09 埋点采集：事件通道、漏斗分析、A/B 实验位。
- FR-10 意见反馈与问题收集：文本/图片反馈与处理流。

## 7. 非功能需求（NFR）
- 性能：p95 API 响应时间 ≤ 300ms（无复杂推理），高峰 QPS 500（可水平扩展）。
- 可用性：服务可用性 ≥ 99.9%，关键链路（登录、支付、评估）具备降级方案。
- 安全与隐私：符合《个人信息保护法》与等保 2.0 要求；最小化数据采集；敏感字段加密/脱敏；权限与审计。
- 可靠性：订单回调幂等、防重；缓存失效与降级策略明确。
- 兼容性：支持 iOS/Android 微信客户端最新两个主版本；屏幕适配 3 类断点。
- 可维护性：模块边界清晰，接口版本化，迁移与配置管理规范。
- 可观测性：结构化日志、指标与告警；关键事件监控与报表。

## 8. 数据需求与字典（概念）
- 用户（User）：id、openId、unionId、昵称、头像、会员状态、偏好。
- 体质画像（ConstitutionProfile）：userId、评估时间、各维度得分、主导体质标签、解释。
- 菜谱（Recipe）：名称、食材/药材、功效标签、禁忌、做法、适配度规则。
- 订单（Order）：orderId、商品类型、金额、状态、支付流水、回调记录。
- 埋点（EventLog）：事件名、页面、时间、用户标识、属性。

## 9. 外部依赖与接口
- 微信登录 jscode2session、支付下单与回调。
- 对象存储（COS/OSS）：图片/音频素材。
- 数据统计/告警渠道：企业微信/飞书机器人、Prometheus。

## 10. 约束与假设
- 初期以规则引擎为主，后续引入模型；所有推荐需可解释并可回滚。
- 云上部署（腾讯云）优先，HTTPS 与证书托管，域名备案。
- 项目遵循语义化版本与 API 版本路径（/api/v1）。

## 11. 验收与度量
- 功能验收：覆盖所有 UC，支付闭环可回溯。
- 质量门禁：lint、测试覆盖率 ≥ 70%、安全扫描零高危。
- 业务指标：评估完成率 ≥ 60%、首日推荐点击率 ≥ 25%、会员转化率（首版）≥ 3%。

## 12. 风险与应对
- 数据准确性：持续与中医专家复核；引入禁忌强约束。
- 支付合规：签名校验与幂等严格执行；沙箱联调与灰度发布。
- 算法偏差：上线监控命中率与满意度，快速回滚到规则版本。

## 13. 里程碑（MVP → 成熟）
- M1：登录、体质评估（规则）、基础推荐与菜谱详情、埋点。
- M2：会员与支付闭环、运营 CMS、看板与 A/B。
- M3：模型化推荐与个性化、活动与素材扩展、性能与成本优化。
