# 接口规范文档（简化版｜Koa2 服务）

版本：v1.1  
适用范围：小程序前端 ↔ Node.js（Koa2）服务端  
依据：《概要设计1.0.md》虚拟人物预制素材方案

## 1. 通用约定
- 基础路径：/api
- 协议与格式：HTTP（本地/内网演示），Content-Type: application/json; charset=utf-8
- 时间：YYYY-MM-DD HH:mm:ss（本地时间即可）
- 认证：无（演示环境不做登录与鉴权）
- 错误码：统一返回 code、message、data

## 2. 统一响应结构
```json
{ "code": 200, "message": "ok", "data": {} }
```
- code：200 表示成功；400 为参数错误；500 为服务端错误

## 3. 体质判定
### POST /api/constitution/judge
- 描述：提交症状列表，返回主体质与匹配详情（计数）
- 请求：
```json
{ "symptoms": ["畏寒","手脚冰凉"] }
```
- 响应：
```json
{
  "code": 200,
  "message": "体质判定成功",
  "data": {
    "mainConstitution": "阳虚质",
    "matchDetail": { "阳虚质": 2, "阴虚质": 0, "气虚质": 0, "平和质": 0 }
  }
}
```

## 4. 食谱查询（含虚拟人物素材链接）
### GET /api/recipe/list
- 描述：按体质获取食谱列表；每条含预制素材链接 video_url
- 参数：constitution（如：阳虚质）
- 响应：
```json
{
  "code": 200,
  "message": "食谱+素材查询成功",
  "data": [
    {
      "id": 1,
      "name": "当归生姜羊肉汤",
      "ingredients": ["羊肉500g","当归10g","生姜30g"],
      "steps": ["1. 羊肉焯水","2. 加水煮沸后慢炖1小时"],
      "video_url": "https://player.bilibili.com/player.html?aid=123456"
    }
  ]
}
```

### GET /api/recipe/material
- 描述：按食谱 ID 单独获取素材链接
- 参数：recipeId
- 响应：
```json
{
  "code": 200,
  "message": "素材链接查询成功",
  "data": { "videoUrl": "https://player.bilibili.com/player.html?aid=123456" }
}
```

## 5. 健康检查
### GET /api/health/check
- 描述：服务端健康检查
- 响应：
```json
{ "code": 200, "message": "服务端正常运行" }
```

## 6. 错误码（简化）
- 200：成功
- 400：参数错误（缺少必填或格式不合法）
- 500：服务器内部错误（数据库/解析异常等）

## 7. 说明与约束
- video_url 支持第三方外链（B站/抖音，建议私密可见）或本地路径（仅限内网演示）
- 为简化演示，不提供登录、会员、支付、分页等能力
- 小程序使用原生 video 组件直接播放返回的 video_url
